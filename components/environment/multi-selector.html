<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="multi-selector">
  <template>
    <ul>
      <template is="dom-repeat" items="{{filteredSelections}}">
          <li on-click="buttonClick">{{item}}</li>   
      </template>
    </ul>
    <ul>
      <template is="dom-repeat" items="{{conditionalSelectionBuilt}}">
          <li on-click="conditionalbuttonClick">{{item}}</li>   
      </template>
    </ul>
  </template>

  <script>
    Polymer({
      is: "multi-selector",
      properties: {
        selections: {
          type: Object,
          value: {}
        },
        uniqueSelection: {
          type: String,
          value: ""
        },
        uniqueSelectionArr: {
          computed: "toArray(uniqueSelection)"
        },
        filteredSelections: {
          computed: "filterUniques(selections, uniqueSelection)"
        },
        conditionalSelection: {
          type : Object,
          value: {}
        },
        conditionalSelectionBuilt: {
          computed: "conditionalSelectionBuild(conditionalSelection)"
        }
      },
      toArray: function(obj) {
        return Object.keys(obj).map(function(key) {
          return {name: key, value: obj[key]};
        });
      },
      buttonClick: function(event, detail, sender) {
        //console.log(this.selections[event.target.innerHTML]);
        //console.log(this.uniqueSelectionArr[0].name);
        if(this.uniqueSelection)
        {
          if(localStorage.getItem(this.uniqueSelectionArr[0].name))
          {
            var tempArr = localStorage.getItem(this.uniqueSelectionArr[0].name);
            localStorage.setItem(this.uniqueSelectionArr[0].name,JSON.stringify(tempArr.concat([this.uniqueSelectionArr[0].value]))); //fuck
          }
          else
          {
            localStorage.setItem(this.uniqueSelectionArr[0].name,JSON.stringify([this.uniqueSelectionArr[0].value]));
          }
        }
        
        document.querySelector('data-house').next = this.selections[event.target.innerHTML];
      },
      filterUniques: function(selections, uniqueSelection) {
        selectionsKeys = Object.keys(selections);
        //console.log(selectionsKeys);
        if(uniqueSelection) // will always be true and will cause null -- fix this later maybe with t/f
        {
          var itmsToFilter = JSON.parse(localStorage.getItem(this.uniqueSelectionArr[0].name));
          for(var i = 0; i < itmsToFilter.length; i++)
          {
            //console.log("This is a unique filter case");
            //console.log(Object.keys(selections).indexOf(itmsToFilter[i]));
            var iToSplice = selectionsKeys.indexOf(itmsToFilter[i]);
            if (iToSplice != -1)
            {
               //console.log("Found In Array");
               selectionsKeys.splice(iToSplice, 1);
            }
          }
          //console.log(selectionsKeys);
          return selectionsKeys
        }
        else
        {
          return selectionsKeys
        }
      },
      conditionalSelectionBuild: function(cSelection) {
        if(cSelection)
        {
          var conditionKey = Object.keys(cSelection.condition)[0];
          var conditionValue = cSelection.condition[conditionKey];
          console.log(conditionKey)
        }
        //var constantKeys = 
      },

      conditionalbuttonClick: function()
      {
        document.querySelector('data-house').next = this.selections[event.target.innerHTML];
      },

      ready : function() {
      }
    });
  </script>
  <!--
  text-block API
  
  selections:

  -->
</dom-module>